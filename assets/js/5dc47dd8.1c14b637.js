"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[458],{6040:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>d,toc:()=>c});var t=n(5250),r=n(720);const i={title:"MACI Command-line interface (CLI)",description:"Introduction to the MACI CLI interface that allows for effective deployment and testing",sidebar_label:"Command-line interface",sidebar_position:7},a="Command-line interface",d={id:"cli",title:"MACI Command-line interface (CLI)",description:"Introduction to the MACI CLI interface that allows for effective deployment and testing",source:"@site/versioned_docs/version-v1.x/cli.md",sourceDirName:".",slug:"/cli",permalink:"/docs/cli",draft:!1,unlisted:!1,editUrl:"https://github.com/privacy-scaling-explorations/maci/edit/dev/website/versioned_docs/version-v1.x/cli.md",tags:[],version:"v1.x",sidebarPosition:7,frontMatter:{title:"MACI Command-line interface (CLI)",description:"Introduction to the MACI CLI interface that allows for effective deployment and testing",sidebar_label:"Command-line interface",sidebar_position:7},sidebar:"version-1.x/mySidebar",previous:{title:"Primitives",permalink:"/docs/primitives"},next:{title:"Smart Contracts",permalink:"/docs/contracts"}},o={},c=[{value:"Subcommands",id:"subcommands",level:2},{value:"Public and private key format",id:"public-and-private-key-format",level:2},{value:"Coordinator: Deploy VkRegistry",id:"coordinator-deploy-vkregistry",level:3},{value:"Coordinator: Set verifying keys",id:"coordinator-set-verifying-keys",level:3},{value:"Coordinator: Create MACI instance",id:"coordinator-create-maci-instance",level:3},{value:"Coordinator: Deploy poll",id:"coordinator-deploy-poll",level:3},{value:"User: sign up",id:"user-sign-up",level:3},{value:"User: publish message",id:"user-publish-message",level:3},{value:"Coordinator: Time travel (Testing only)",id:"coordinator-time-travel-testing-only",level:3},{value:"Coordinator: merge state tree",id:"coordinator-merge-state-tree",level:3},{value:"Coordinator: merge message tree",id:"coordinator-merge-message-tree",level:3},{value:"Coordinator: generate Maci state offchain",id:"coordinator-generate-maci-state-offchain",level:3},{value:"Coordinator: generate proofs",id:"coordinator-generate-proofs",level:3},{value:"Coordinator: generate proofs using a local state file",id:"coordinator-generate-proofs-using-a-local-state-file",level:3},{value:"Coordinator: prove on chain",id:"coordinator-prove-on-chain",level:3},{value:"Anyone: verify tally",id:"anyone-verify-tally",level:3},{value:"Demonstration",id:"demonstration",level:2},{value:"Scenario:",id:"scenario",level:3},{value:"Examples of serialized public and private keys:",id:"examples-of-serialized-public-and-private-keys",level:3},{value:"Coordinator: Deploy VkRegistry",id:"coordinator-deploy-vkregistry-1",level:3},{value:"Coordinator: Set verifying keys",id:"coordinator-set-verifying-keys-1",level:3},{value:"Coordinator: Create MACI instance",id:"coordinator-create-maci-instance-1",level:3},{value:"Coordinator: Deploy poll",id:"coordinator-deploy-poll-1",level:3},{value:"Alice: sign up",id:"alice-sign-up",level:3},{value:"Alice: votes for Party A (option index 0)",id:"alice-votes-for-party-a-option-index-0",level:3},{value:"Alice: submits an invalid vote for Party B (option index 1) with different public key",id:"alice-submits-an-invalid-vote-for-party-b-option-index-1-with-different-public-key",level:3},{value:"Coordinator: Time Travel",id:"coordinator-time-travel",level:3},{value:"Coordinator: merge state tree",id:"coordinator-merge-state-tree-1",level:3},{value:"Coordinator: merge message tree",id:"coordinator-merge-message-tree-1",level:3},{value:"Coordinator: generate proofs",id:"coordinator-generate-proofs-1",level:3},{value:"Coordinator: prove on chain",id:"coordinator-prove-on-chain-1",level:3},{value:"Anyone: verify",id:"anyone-verify",level:3}];function l(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h1,{id:"command-line-interface",children:"Command-line interface"}),"\n",(0,t.jsxs)(s.p,{children:["MACI provides a command-line interface that allows for effective deployment and\ntesting. Applications that build on top of MACI, such as\n",(0,t.jsx)(s.a,{href:"https://clr.fund/",children:"clr.fund"}),", implement their own web UIs."]}),"\n",(0,t.jsxs)(s.p,{children:["Note that all the example commands default to a local Ethereum testnet at\n",(0,t.jsx)(s.code,{children:"http://localhost:8545"}),", and use the Ethereum private key\n",(0,t.jsx)(s.code,{children:"0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3"}),". Do not\nsend any real funds to the address generated by this key."]}),"\n",(0,t.jsx)(s.p,{children:"For testing purposes, you can run:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# in maci/contracts\npnpm run hardhat\n"})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsx)(s.p,{children:"Note that you will need a hardhat.config file in your current directory to be able to run the cli."}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"subcommands",children:"Subcommands"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Command"}),(0,t.jsx)(s.th,{children:"Description"}),(0,t.jsx)(s.th,{children:"Options"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"create"})}),(0,t.jsx)(s.td,{children:"Deploy the contracts"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-v, --vkRegistryAddress <vkRegistryAddress>"}),": The vk registry contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-i, --initialVoiceCredits <initialVoiceCredits>"}),": The initial voice credits ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-p, --initialVoiceCreditsProxyAddress <initialVoiceCreditsProxyAddress>"}),": The initial voice credits proxy contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-g, --signupGatekeeperAddress <signupGatekeeperAddress>"}),": The signup gatekeeper contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-ph3, --poseidonT3Address <poseidonT3Address>"}),": The PoseidonT3 contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-ph4, --poseidonT4Address <poseidonT4Address>"}),": The PoseidonT4 contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-ph5, --poseidonT5Address <poseidonT5Address>"}),": The PoseidonT5 contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-ph6, --poseidonT6Address <poseidonT6Address>"}),": The PoseidonT6 contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-s, --stateTreeDepth <stateTreeDepth>"}),": The state tree depth"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"checkVerifyingKeys"})}),(0,t.jsx)(s.td,{children:"Check that the verifying keys in the contract match the local ones"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-vk, --vk-contract <vkContract>"}),": The VkRegistry contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-s, --state-tree-depth <stateTreeDepth>"}),": The state tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-i, --int-state-tree-depth <intStateTreeDepth>"}),": The intermediate state tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-m, --msg-tree-depth <messageTreeDepth>"}),": The message tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-v, --vote-option-tree-depth <voteOptionTreeDepth>"}),": The vote option tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-b, --msg-batch-depth <messageBatchDepth>"}),": The message batch depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-p, --process-messages-zkey <processMessagesZkeyPath>"}),": The process messages zkey path (see different options to use specific circuits ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/trusted-setup",children:"Trusted setup"})," or ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/testing/#pre-compiled-artifacts-for-testing",children:"Testing"}),") ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-t, --tally-votes-zkey <tallyVotesZkeyPath>"}),": The tally votes zkey path (see different options to use specific circuits ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/trusted-setup",children:"Trusted setup"})," or ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/testing/#pre-compiled-artifacts-for-testing",children:"Testing"}),") ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-ss, --subsidy-zkey <subsidyZkeyPath>"}),": The subsidy zkey path (see different options to use specific circuits ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/trusted-setup",children:"Trusted setup"})," or ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/testing/#pre-compiled-artifacts-for-testing",children:"Testing"}),")"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"genMaciPubKey"})}),(0,t.jsx)(s.td,{children:"Generate a new MACI public key"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-sk, --privkey <privkey>"}),": The private key"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"genMaciKeyPair"})}),(0,t.jsx)(s.td,{children:"Generate a new MACI key pair"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"-sp, --seed <seed> seed value for keypair"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"airdrop"})}),(0,t.jsx)(s.td,{children:"Airdrop topup credits to the coordinator"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-a, --amount <amount>"}),": The amount of topup ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --contract <contract>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-o, --poll-id <pollId>"}),": Poll id ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-t, --token-address <tokenAddress>"}),": The token address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"deployVkRegistry"})}),(0,t.jsx)(s.td,{children:"Deploy a new verification key registry contract"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"show"})}),(0,t.jsx)(s.td,{children:"Show the deployed contract addresses"}),(0,t.jsx)(s.td,{children:"No options"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"deployPoll"})}),(0,t.jsx)(s.td,{children:"Deploy a new poll"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-t, --duration <pollDuration>"}),": The poll duration ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-g, --max-messages <maxMessages>"}),": The max messages ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-mv, --max-vote-options <maxVoteOptions>"}),": The max vote options ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-i, --int-state-tree-depth <intStateTreeDepth>"}),": The int state tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-b, --msg-batch-depth <messageTreeSubDepth>"}),": The message tree sub depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-m, --msg-tree-depth <messageTreeDepth>"}),": The message tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-v, --vote-option-tree-depth <voteOptionTreeDepth>"}),": The vote option tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-pk, --pubkey <coordinatorPubkey>"}),": The coordinator public key ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --maci-address <maciAddress>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"setVerifyingKeys"})}),(0,t.jsx)(s.td,{children:"Set the verifying keys"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-s, --state-tree-depth <stateTreeDepth>"}),": The state tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-i, --int-state-tree-depth <intStateTreeDepth>"}),": The intermediate state tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-m, --msg-tree-depth <messageTreeDepth>"}),": The message tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-v, --vote-option-tree-depth <voteOptionTreeDepth>"}),": The vote option tree depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-b, --msg-batch-depth <messageBatchDepth>"}),": The message batch depth ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-p, --process-messages-zkey <processMessagesZkeyPath>"}),": The process messages zkey path (see different options to use specific circuits ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/trusted-setup",children:"Trusted setup"})," or ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/testing/#pre-compiled-artifacts-for-testing",children:"Testing"}),") ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-t, --tally-votes-zkey <tallyVotesZkeyPath>"}),": The tally votes zkey path (see different options to use specific circuits ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/trusted-setup",children:"Trusted setup"})," or ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/testing/#pre-compiled-artifacts-for-testing",children:"Testing"}),") ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-k, --vk-registry <vkRegistry>"}),": The vk registry contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-ss, --subsidy-zkey <subsidyZkeyPath>"}),": The subsidy zkey path (see different options to use specific circuits ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/trusted-setup",children:"Trusted setup"})," or ",(0,t.jsx)(s.a,{href:"https://maci.pse.dev/docs/testing/#pre-compiled-artifacts-for-testing",children:"Testing"}),")"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"publish"})}),(0,t.jsx)(s.td,{children:"Publish a new message to a MACI Poll contract"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-p, --pubkey <pubkey>"}),": The MACI public key which should replace the user's public key in the state tree ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --contract <contract>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-sk, --privkey <privkey>"}),": Your serialized MACI private key ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-i, --state-index <stateIndex>"}),": The user's state index ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-v, --vote-option-index <voteOptionIndex>"}),": The vote option index ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-n, --nonce <nonce>"}),": The message nonce ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-s, --salt <salt>"}),": The message salt ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-o, --poll-id <pollId>"}),": The poll id ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-w, --new-vote-weight <newVoteWeight>"}),": The new vote weight ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"mergeMessages"})}),(0,t.jsx)(s.td,{children:"Merge the message accumulator queue"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --maci-contract-address <maciContractAddress>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-o, --poll-id <pollId>"}),": The poll id ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-n, --num-queue-ops <numQueueOps>"}),": The number of queue operations"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"mergeSignups"})}),(0,t.jsx)(s.td,{children:"Merge the signups accumulator queue"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --maci-contract-address <maciContractAddress>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-o, --poll-id <pollId>"}),": The poll id ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-n, --num-queue-ops <numQueueOps>"}),": The number of queue operations"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"timeTravel"})}),(0,t.jsx)(s.td,{children:"Fast-forward the time (only works for local hardhat testing)"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-s, --seconds <seconds>"}),": The number of seconds to fast-forward ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"signup"})}),(0,t.jsx)(s.td,{children:"Sign up to a MACI contract"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-p, --pubkey <maciPubKey>"}),": The MACI public key ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --maci-address <maciAddress>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-s, --sg-data <sgData>"}),": The signup gateway data ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-i, --ivcp-data <ivcpData>"}),": The initial voice credit proxy data ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"isRegisteredUser"})}),(0,t.jsx)(s.td,{children:"Checks if user is registered with public key"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-p, --pubkey <maciPubKey>"}),": The MACI public key ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --maci-address <maciAddress>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"topup"})}),(0,t.jsx)(s.td,{children:"Top up an account with voice credits"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-a, --amount <amount>"}),": The amount of topup ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --maci-address <maciAddress>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-i, --state-index <stateIndex>"}),": State leaf index ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-o, --poll-id <pollId>"}),": Poll id ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"fundWallet"})}),(0,t.jsx)(s.td,{children:"Fund a wallet with Ether"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-a, --amount <amount>"}),": The amount of Ether ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-w, --address <address>"}),": The address to fund ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"verify"})}),(0,t.jsx)(s.td,{children:"Verify the results of a poll and optionally the subsidy results on-chain"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-o, --poll-id <pollId>"}),": The poll id ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-t, --tally-file <tallyFile>"}),": The tally file with results, per vote option spent credits, spent voice credits total ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-s, --subsidy-file <subsidyFile>"}),": The subsidy file ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --contract <contract>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-tc, --tally-contract <tallyContract>"}),": The tally contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-sc, --subsidy-contract <subsidyContract>"}),": The subsidy contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"genProofs"})}),(0,t.jsx)(s.td,{children:"Generate the proofs for a poll"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-sk, --privkey <privkey>"}),": Your serialized MACI private key ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --contract <contract>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-o, --poll-id <pollId>"}),": The poll id ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-t, --tally-file <tallyFile>"}),": The tally file ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-s, --subsidy-file <subsidyFile>"}),": The subsidy file ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-r, --rapidsnark <rapidsnark>"}),": The path to the rapidsnark binary ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-wp, --process-witnessgen <processWitnessgen>"}),": The path to the process witness generation binary ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-wt, --tally-witnessgen <tallyWitnessgen>"}),": The path to the tally witness generation binary ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-ws, --subsidy-witnessgen <subsidyWitnessgen>"}),": The path to the subsidy witness generation binary ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-zp, --process-zkey <processZkey"}),": The path to the process zkey ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-zt, --tally-zkey <tallyZkey>"}),": The path to the tally zkey ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-zs, --subsidy-zkey <subsidyZkey>"}),": The path to the subsidy zkey ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-f, --output <outputDir>"}),": The output directory for proofs ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-tx, --transaction-hash <transactionHash>:"})," Transaction hash of MACI contract creation ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-w, --wasm"}),": Whether to use the wasm binaries ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-pw, --process-wasm <processWasm>"}),": The path to the process witness generation wasm binary ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-tw, --tally-wasm <tallyWasm>"}),": The path to the tally witness generation wasm binary ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-sw, --subsidy-wasm <subsidyWasm>"}),": The path to the subsidy witness generation wasm binary ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-uq, --use-quadratic-voting"}),": Whether to process messages and tally votes using quadratic voting or not"]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"proveOnChain"})}),(0,t.jsx)(s.td,{children:"Prove the results of a poll on chain"}),(0,t.jsxs)(s.td,{children:[(0,t.jsx)(s.code,{children:"-o, --poll-id <pollId>"}),": The poll id ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-q, --quiet"}),": Whether to print values to the console ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-x, --contract <contract>"}),": The MACI contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-p, --message-processor-address <messageProcessorAddress>"}),": The message processor contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-t, --tally-contract <tallyContract>"}),": The tally contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-s, --subsidy-contract <subsidyContract>"}),": The subsidy contract address ",(0,t.jsx)("br",{})," ",(0,t.jsx)(s.code,{children:"-f, --proof-dir <proofDir>"}),": The proof output directory from the genProofs subcommand"]})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"public-and-private-key-format",children:"Public and private key format"}),"\n",(0,t.jsxs)(s.p,{children:["MACI uses private keys in the BabyJub field for operations which occur within\nzk-SNARKs, such as decrypting messages or signing commands. As MACI is deployed\non Ethereum, we seek to avoid confusing BabyJub private keys with Ethereum\nprivate keys. To that end, users should pass serialized formats of public and\nprivate keys to this CLI. We use ",(0,t.jsx)(s.code,{children:"maci-domainobj"}),"'s ",(0,t.jsx)(s.code,{children:"PrivKey.serialize"})," and\n",(0,t.jsx)(s.code,{children:"PubKey.serialize"})," functions to do so."]}),"\n",(0,t.jsx)(s.p,{children:"Examples of serialized public and private keys:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Public key: macipk.1e03ee6ec5ee1d0dd9bcc5c91c10df8f2e37e134d9737a0239b361cd2809ae9e\nPrivate key: macisk.a87fbc475cf8e42231a6dd487b41ccc935e7d2de08565f1ba6ecd7464694b85e\n"})}),"\n",(0,t.jsx)(s.p,{children:"###\xa0Generate MACI keys"}),"\n",(0,t.jsx)(s.p,{children:"You can generate MACI keys using the following cli utility."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js genMaciKeyPair\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[\u2713] Public key: macipk.78e716652dfd1cc8f5fb0b45f656b493135edba5447cfc5e68c2f568d22e7193\n[\u2713] Private key: macisk.16b5a5b7fff5537f515a0b03e364cab43d7cce861cdba9fe5a1fff2b667f86d8\n"})}),"\n",(0,t.jsx)(s.p,{children:"If you already have a MACI private key in serialized form, you can generate its corresponding public key using the following command:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js genMaciPubKey -sk macisk.16b5a5b7fff5537f515a0b03e364cab43d7cce861cdba9fe5a1fff2b667f86d8\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[\u2713] Public key: macipk.78e716652dfd1cc8f5fb0b45f656b493135edba5447cfc5e68c2f568d22e7193\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-deploy-vkregistry",children:"Coordinator: Deploy VkRegistry"}),"\n",(0,t.jsxs)(s.p,{children:["This command deploys an instance of a VkRegistry contract. Multiple MACI\ncontracts can refer to the same VkRegistry as long as they are all owned (via\n",(0,t.jsx)(s.code,{children:"Ownable.sol"}),") by the same account."]}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js deployVkRegistry\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[\u2713] VkRegistry deployed at: 0x6b5A4751307F6751E265c194244552A9995B6B3D\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-set-verifying-keys",children:"Coordinator: Set verifying keys"}),"\n",(0,t.jsxs)(s.p,{children:["Note that the filename of the ",(0,t.jsx)(s.code,{children:".zkey"})," files must follow this format:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"ProcessMessages_<STATE_TREE_DEPTH>-<MSG_TREE_DEPTH>-<MSG_SUBTREE_DEPTH>-<VOTE_OPTION_TREE_DEPTH>_test.<CONTRIBUTION_NUM>.zkey\nTallyVotes_<STATE_TREE_DEPTH>-<INT_STATE_TREE_DEPTH>-<VOTE_OPTION_TREE_DEPTH>>_test.<CONTRIBUTION_NUM>>.zkey\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js setVerifyingKeys \\\n    -s 10 -i 1 -m 2 -v 2 -b 1 \\\n    -p ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey \\\n    -t ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey \\\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] Setting verifying keys...\n[i] Transaction hash: 0x6b5b2959ba5161497d5499a0f9d9c69f773cd5f9b82f80a79253797b066863e3\n[\u2713] Verifying keys set successfully\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-create-maci-instance",children:"Coordinator: Create MACI instance"}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js create -s 10\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[\u2713] MACI deployed at:  0xB08CEd0f34940a3E576Cf023b287f9Db2f306a1f\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-deploy-poll",children:"Coordinator: Deploy poll"}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node ./build/ts/index.js deployPoll \\\n    -pk macipk.78e716652dfd1cc8f5fb0b45f656b493135edba5447cfc5e68c2f568d22e7193 \\\n    -t 300 -i 1 -m 2 -b 1 -v 2\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] Poll ID: 0\n[i] Poll contract: 0xB6389Da0285c7B1FC0ba352F5A1D5fb1A492a786\n[i] Message processor contract: 0xE0bF6021e023a197DBb3fABE64efA880E13D3f4b\n[i] Tally contract: 0x3f21BC64076e7c9ed8695d053DCCBE6D8d5E6f43\n[i] Subsidy contract: 0xb848ef765E289762e9BE66a38006DDc4D23AeF24\n"})}),"\n",(0,t.jsx)(s.h3,{id:"user-sign-up",children:"User: sign up"}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node ./build/ts/index.js signup \\\n    -p macisk.1a5103582662c0ada112bc5aac9202fbe51de84aa249989cbbbf9569eff19697\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] Transaction hash: 0x4c7c9f65187fcf6e243804b75555bda48cbae4c317bb312f1b9f95ac4b7697b1\n[\u2713] State index: 1\n"})}),"\n",(0,t.jsx)(s.h3,{id:"user-publish-message",children:"User: publish message"}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js publish \\\n    -p macisk.1a5103582662c0ada112bc5aac9202fbe51de84aa249989cbbbf9569eff19697 \\\n    -sk macipk.a3c6a51848e96cf7b635931f450f61de4f907fbdcaaaadeaa1ac6b8a0ae1481c \\\n    -i 1 -v 0 -w 9 -n 1 -o 0\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] Transaction hash: 0xa2ab91c821bf7fa73fedcf19a5371a0f0866ae0747d22f82f1685afca0e5db49\n[i] Ephemeral private key: macisk.2631d585e46f059e4909ab35172451542ed7723a1ace120fcf49d68e27f935b0\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-time-travel-testing-only",children:"Coordinator: Time travel (Testing only)"}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js timeTravel -s 300\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[\u2713] Fast-forwarded 300 seconds\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-merge-state-tree",children:"Coordinator: merge state tree"}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js mergeSignups -o 0\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] Merging state subroots 1 / 1\n[i] Transaction hash: 0xd7e7312f70831ec05bb23f23f506ef37d6ce0c2056c1b72f7bb989653d1c8a42\n[\u2713] Executed mergeMaciStateAqSubRoots(); gas used: 720061\n[\u2713] All state subtrees have been merged.\n[i] Merging subroots to a main state root...\n[i] Transaction hash: 0xb5e98d328b066d91e1b7aa35775fe624be446b540a00bcb4b27a02477636b569\n[\u2713] Executed mergeStateAq(); gas used: 1004720\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-merge-message-tree",children:"Coordinator: merge message tree"}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js mergeMessages -o 0\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] Merging message subroots 1 / 1\n[\u2713] Executed mergeMessageAqSubRoots(); gas used: 602448\n[i] Transaction hash: 0xdf9d11c6b35fcccff82dafa3aa15f760e3f7694a72b07007fbdb359d44df0bea\n[\u2713] All message subtrees have been merged.\n[i] Merging subroots to a main message root...\n[\u2713] Executed mergeMessageAq(); gas used: 173346\n[i] Transaction hash: 0x1f18ec08fd14db90a0d1d02d1ed27c0bfd3bc138701e812c4c3382572fc4d151\n[\u2713] The message tree has been merged.\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-generate-maci-state-offchain",children:"Coordinator: generate Maci state offchain"}),"\n",(0,t.jsx)(s.p,{children:"Example usage to generate the state locally from the smart contracts events:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js genLocalState \\\n    --poll-id 0 \\\n    --output localState.json \\\n    --privkey macisk.16b5a5b7fff5537f515a0b03e364cab43d7cce861cdba9fe5a1fff2b667f86d8 \\\n    --blocks-per-batch 50\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] Fetching logs from 0 till 228 and generating the offline maci state\n[\u2713] The state has been written to localState.json\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-generate-proofs",children:"Coordinator: generate proofs"}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"C++ witness parameters"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js genProofs -x 0x89962fa216d39fCcaaC11e1e462340d80ab6Cf4D \\\n    -sk macisk.16b5a5b7fff5537f515a0b03e364cab43d7cce861cdba9fe5a1fff2b667f86d8 \\\n    -o 0 \\\n    -t tally.json \\\n    -f proofs \\\n    -r ~/rapidsnark/build/prover \\\n    -wp ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test_cpp/ProcessMessages_10-2-1-2_test \\\n    -wt ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test_cpp/TallyVotes_10-1-2_test \\\n    -zp ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey \\\n    -zt ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey \\\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"WASM Parameters"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js genProofs \\\n    -sk macisk.16b5a5b7fff5537f515a0b03e364cab43d7cce861cdba9fe5a1fff2b667f86d8 \\\n    -o 0 \\\n    -t tally.json \\\n    -f proofs \\\n    -zp ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey \\\n    -zt ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey \\\n    -tw ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test_js/TallyVotes_10-1-2_test.wasm \\\n    -pw ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test_js/ProcessMessages_10-2-1-2_test.wasm \\\n    -w true \\\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Non Quadratic Voting"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js genProofs \\\n    -sk macisk.16b5a5b7fff5537f515a0b03e364cab43d7cce861cdba9fe5a1fff2b667f86d8 \\\n    -o 0 \\\n    -t tally.json \\\n    -f proofs \\\n    -zp ./zkeys/ProcessMessagesNonQv_10-2-1-2_test/ProcessMessagesNonQv_10-2-1-2_test.0.zkey \\\n    -zt ./zkeys/TallyVotesNonQv_10-1-2_test/TallyVotesNonQv_10-1-2_test.0.zkey \\\n    -tw ./zkeys/TallyVotesNonQv_10-1-2_test/TallyVotesNonQv_10-1-2_test_js/TallyVotesNonQv_10-1-2_test.wasm \\\n    -pw ./zkeys/ProcessMessagesNonQv_10-2-1-2_test/ProcessMessagesNonQv_10-2-1-2_test_js/ProcessMessagesNonQv_10-2-1-2_test.wasm \\\n    -w true \\\n    -uq false\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] starting to fetch logs from block 0\n[i] Generating proofs of message processing...\n[i] Progress: 1 / 1\n[i] gen processMessage proof took 17.322 seconds\n\n[i] Generating proofs of vote tallying...\n[i] Progress: 1 / 1\n[\u2713] The tally commitment is correct\n[i] gen tally proof took 4.951 seconds\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-generate-proofs-using-a-local-state-file",children:"Coordinator: generate proofs using a local state file"}),"\n",(0,t.jsx)(s.p,{children:"Example usage to generate the proofs locally from the local state file created with genLocalState:"}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"C++ witness parameters"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js genProofs \\\n    --privkey macisk.16b5a5b7fff5537f515a0b03e364cab43d7cce861cdba9fe5a1fff2b667f86d8 \\\n    --poll-id 0 \\\n    --rapidsnark ~/rapidsnark/build/prover \\\n    --process-witnessgen ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test_cpp/ProcessMessages_10-2-1-2_test \\\n    --tally-witnessgen ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test_cpp/TallyVotes_10-1-2_test \\\n    --process-zkey /zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey \\\n    --tally-zkey ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey \\\n    --tally-file tally.json \\\n    --output proofs/ \\\n    --state-file localState.json\n"})}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"WASM Params"})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js genProofs \\\n    --privkey macisk.16b5a5b7fff5537f515a0b03e364cab43d7cce861cdba9fe5a1fff2b667f86d8 \\\n    --poll-id 0 \\\n    --process-zkey ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey \\\n    --tally-zkey ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey \\\n    --tally-file tally.json \\\n    --output proofs/ \\\n    --state-file localState.json \\\n    -tw ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test_js/TallyVotes_10-1-2_test.wasm \\\n    -pw ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test_js/ProcessMessages_10-2-1-2_test.wasm \\\n    -w true\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] Generating proofs of message processing...\n[i] Progress: 1 / 1\n[i] gen processMessage proof took 17.053 seconds\n\n[i] Generating proofs of vote tallying...\n[i] Progress: 1 / 1\n[\u2713] The tally commitment is correct\n[i] gen tally proof took 4.746 seconds\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-prove-on-chain",children:"Coordinator: prove on chain"}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js proveOnChain \\\n    -o 0 \\\n    -f proofs/\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] Submitting proofs of message processing...\n[i] Transaction hash: 0xa8acf67d6520ceaf5eef8acbf4cda7f5c2657122e2a72a092b9f4503282d70b9\n[i] Progress: 1 / 1\n[\u2713] All message processing proofs have been submitted.\n[i] Submitting proofs of vote tallying...\n[i] Progress: 1 / 1\n[i] Transaction hash: 0x691687ab6fb504919859901f297cdb7d8c4d736756d2d4edf345d721bb82365b\n[\u2713] All vote tallying proofs have been submitted.\n"})}),"\n",(0,t.jsx)(s.h3,{id:"anyone-verify-tally",children:"Anyone: verify tally"}),"\n",(0,t.jsx)(s.p,{children:"Example usage:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js verify \\\n    -o 0 \\\n    -t tally.json\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[i] on-chain tally commitment: 83601b7979c13506317b58e859950e9e92e1e6d326810d89332cc13909833ec\n[\u2713] The on-chain tally commitment matches.\n[i] The on-chain tally matches the off-chain tally.\n"})}),"\n",(0,t.jsx)(s.h2,{id:"demonstration",children:"Demonstration"}),"\n",(0,t.jsx)(s.h3,{id:"scenario",children:"Scenario:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Alice votes for Party A"}),"\n",(0,t.jsx)(s.li,{children:"Alice changes her key"}),"\n",(0,t.jsx)(s.li,{children:"Eve tries to bribe Alice to change her vote to Party B"}),"\n",(0,t.jsx)(s.li,{children:"Alice submits an invalid vote for Party B"}),"\n",(0,t.jsx)(s.li,{children:"The coordinator processes the votes, computes, and verifies the final tally"}),"\n",(0,t.jsx)(s.li,{children:"The expected result is: Party A has some votes and Party B has 0 votes."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Implication: Alice's invalid vote was not counted, and Eve had no way to tell."}),"\n",(0,t.jsx)(s.h3,{id:"examples-of-serialized-public-and-private-keys",children:"Examples of serialized public and private keys:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Coordinator:\nPrivate key: macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e\nPublic key:  macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330\n\nAlice:\nPrivate key: macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c\nPublic key:  macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-deploy-vkregistry-1",children:"Coordinator: Deploy VkRegistry"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js deployVkRegistry\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[\u2713] VkRegistry deployed at: 0x7607Cfe2fA0d62F725537e55d83C693Cc3C76EF2\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-set-verifying-keys-1",children:"Coordinator: Set verifying keys"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js setVerifyingKeys \\\n    --state-tree-depth 10 \\\n    --int-state-tree-depth 1 \\\n    --msg-tree-depth 2 \\\n    --vote-option-tree-depth 2 \\\n    --msg-batch-depth 1 \\\n    --process-messages-zkey ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey \\\n    --tally-votes-zkey ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[i] Setting verifying keys...\n[i] Transaction hash: 0xbd5d06935537fb59903c27b9bdb19a41d422f75e1dfd6eb61f028bf3a7b82c76\n[\u2713] Verifying keys set successfully\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-create-maci-instance-1",children:"Coordinator: Create MACI instance"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js create -s 10\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[\u2713] MACI deployed at:  0xC131D3eeD9D6D410A7bfc200d81b9795f1bb5ed6\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-deploy-poll-1",children:"Coordinator: Deploy poll"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node ./build/ts/index.js deployPoll \\\n    -pk macipk.c974f4f168b79727ac98bfd53a65ea0b4e45dc2552fe73df9f8b51ebb0930330 \\\n    -t 1000 -i 1 -m 2 -b 1 -v 2\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[i] Poll ID: 0\n[i] Poll contract: 0x2c3Adf2852788662148038511aD80962aaf631D7\n[i] Message processor contract: 0xd3C3C6530fE4073292D6EAfdEAdEeAbf1A3DC19B\n[i] Tally contract: 0x06c1939F6cBb68D42333F140CAE815cc36D341b0\n[i] Subsidy contract: 0xCB74254716c96B07c812c73A5945e68aa1de4569\n"})}),"\n",(0,t.jsx)(s.h3,{id:"alice-sign-up",children:"Alice: sign up"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node ./build/ts/index.js signup \\\n    --pubkey macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[i] Transaction hash: 0x7ab4c2d23686049432d19bb64c8ee4e8776fff134d971dcf27e1f513b4fdb97f\n[\u2713] State index: 1\n"})}),"\n",(0,t.jsx)(s.h3,{id:"alice-votes-for-party-a-option-index-0",children:"Alice: votes for Party A (option index 0)"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js publish \\\n    --pubkey macipk.3e7bb2d7f0a1b7e980f1b6f363d1e3b7a12b9ae354c2cd60a9cfa9fd12917391 \\\n    --privkey macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c \\\n    --state-index 1 \\\n    --vote-option-index 0 \\\n    --new-vote-weight 9 \\\n    --nonce 1 \\\n    --poll-id 0\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[i] Transaction hash: 0x60936cfb0b25c8618d3cb8d0f5497106d5f6e3776f3212932975442d874eddbd\n[i] Ephemeral private key: macisk.103b8c4c98700d06f47522892032fce54bd03cd197cee495ede3802730409910\n"})}),"\n",(0,t.jsx)(s.h3,{id:"alice-submits-an-invalid-vote-for-party-b-option-index-1-with-different-public-key",children:"Alice: submits an invalid vote for Party B (option index 1) with different public key"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js publish \\\n    --pubkey macipk.d5788ea6ccf1ec295df99aaef859031fe7bd359e7e03acb80eb6e8a192f2ce19 \\\n    --privkey macisk.fd7aa614ec4a82716ffc219c24fd7e7b52a2b63b5afb17e81c22fe21515539c \\\n    --state-index 1 \\\n    --vote-option-index 1 \\\n    --new-vote-weight 9 \\\n    --nonce 2 \\\n    --poll-id 0\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[i] Transaction hash: 0x73f74b13d276cd311ce5421a145debc71e97e48abc8be2f9a0a548b26f7920f9\n[i] Ephemeral private key: macisk.1e490d67477b4c5f08806973fca2bea81e723c60deba6bdeacab56f7a4bd867b\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-time-travel",children:"Coordinator: Time Travel"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js timeTravel -s 1000\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[\u2713] Fast-forwarded 1000 seconds\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-merge-state-tree-1",children:"Coordinator: merge state tree"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js mergeSignups --poll-id 0\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[i] Merging state subroots 1 / 1\n[i] Transaction hash: 0xd01932e8dfad251f9b0d288290ac17f12bc449ea859a6921f63edf6b4b06f4c9\n[\u2713] Executed mergeMaciStateAqSubRoots(); gas used: 720061\n[\u2713] All state subtrees have been merged.\n[i] Merging subroots to a main state root...\n[i] Transaction hash: 0x25f60a9b5a24d11b87c41d8a4f681e3fd895b3bdf78ea86755b9800005662ce6\n[\u2713] Executed mergeStateAq(); gas used: 1004720\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-merge-message-tree-1",children:"Coordinator: merge message tree"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js mergeMessages --poll-id 0\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[i] Merging message subroots 1 / 1\n[\u2713] Executed mergeMessageAqSubRoots(); gas used: 600520\n[i] Transaction hash: 0xac0e8a01277db1b6282f8fb3763a8a4aeeebb3e12a41dd0dee9fc2804a4c9e81\n[\u2713] All message subtrees have been merged.\n[i] Merging subroots to a main message root...\n[\u2713] Executed mergeMessageAq(); gas used: 173346\n[i] Transaction hash: 0x472f0fd515c7cd2a02c430189e4ee92a6843bd6b19807484ce454cb7dab0e931\n[\u2713] The message tree has been merged.\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-generate-proofs-1",children:"Coordinator: generate proofs"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js genProofs \\\n    --privkey macisk.49953af3585856f539d194b46c82f4ed54ec508fb9b882940cbe68bbc57e59e \\\n    --poll-id 0 \\\n    --process-zkey ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey \\\n    --tally-zkey ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey \\\n    --tally-file tally.json \\\n    --output proofs/ \\\n    -tw ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test_js/TallyVotes_10-1-2_test.wasm \\\n    -pw ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test_js/ProcessMessages_10-2-1-2_test.wasm \\\n    -w true\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[i] Generating proofs of message processing...\n[i] Progress: 1 / 1\n[i] gen processMessage proof took 16.644 seconds\n\n[i] Generating proofs of vote tallying...\n[i] Progress: 1 / 1\n[\u2713] The tally commitment is correct\n[i] gen tally proof took 4.809 seconds\n"})}),"\n",(0,t.jsx)(s.h3,{id:"coordinator-prove-on-chain-1",children:"Coordinator: prove on chain"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js proveOnChain \\\n    --poll-id 0 \\\n    --proof-dir proofs/\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[i] Submitting proofs of message processing...\n[i] Transaction hash: 0x9c3280af80de2436f9a886e4cd94218e01fe35ea3d3e671aad97b5aa5d6108ed\n[i] Progress: 1 / 1\n[\u2713] All message processing proofs have been submitted.\n[i] Submitting proofs of vote tallying...\n[i] Progress: 1 / 1\n[i] Transaction hash: 0x3e82ae3ad04215d4f357455ab5a610eba082796d2abc698aad91b046d16b9350\n[\u2713] All vote tallying proofs have been submitted.\n"})}),"\n",(0,t.jsx)(s.h3,{id:"anyone-verify",children:"Anyone: verify"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"node build/ts/index.js verify \\\n    --poll-id 0 \\\n    --tally-file tally.json\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"[i] on-chain tally commitment: 1ed004ac21a5397a512cbe749e7110934a434837f4818265043fd2e2e9cbec91\n[\u2713] The on-chain tally commitment matches.\n"})})]})}function h(e={}){const{wrapper:s}={...(0,r.a)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},720:(e,s,n)=>{n.d(s,{Z:()=>d,a:()=>a});var t=n(79);const r={},i=t.createContext(r);function a(e){const s=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:s},e.children)}}}]);