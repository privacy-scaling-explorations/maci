<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-v1.x docs-doc-page docs-doc-id-integrating" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Integrating MACI | MACI</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://maci.pse.dev/img/maci-card.png"><meta data-rh="true" name="twitter:image" content="https://maci.pse.dev/img/maci-card.png"><meta data-rh="true" property="og:url" content="https://maci.pse.dev/docs/integrating"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="v1.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-v1.x"><meta data-rh="true" name="docsearch:version" content="v1.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-v1.x"><meta data-rh="true" property="og:title" content="Integrating MACI | MACI"><meta data-rh="true" name="description" content="How to integrate MACI into your application"><meta data-rh="true" property="og:description" content="How to integrate MACI into your application"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://maci.pse.dev/docs/integrating"><link data-rh="true" rel="alternate" href="https://maci.pse.dev/docs/integrating" hreflang="en"><link data-rh="true" rel="alternate" href="https://maci.pse.dev/docs/integrating" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="MACI RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="MACI Atom Feed">





<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3efc238b.css">
<script src="/assets/js/runtime~main.7b824cc5.js" defer="defer"></script>
<script src="/assets/js/main.4388e5a6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_ML3d" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">MACI</b></a><a class="navbar__item navbar__link" href="/docs/introduction">Documentation</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/roadmap">Roadmap</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/introduction">v1.x</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/integrating">v1.x</a></li><li><a class="dropdown__link" href="/docs/v0.x/introduction">v0.x</a></li></ul></div><div class="navbarSearchContainer_qEKT"><div class="navbar__search searchBarContainer_NuUV"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_B52I searchBarLoadingRing_of1z"><div></div><div></div><div></div><div></div></div></div></div><a href="https://github.com/privacy-scaling-explorations/maci" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_zI7a"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_a2Ef colorModeToggle_J33C"><button class="clean-btn toggleButton_K7OJ toggleButtonDisabled_JIWS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_X1z7"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wOoS"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_aR1s"><div class="docsWrapper_d1tO"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_CI3s" type="button"></button><div class="docRoot_Ec1W"><aside class="theme-doc-sidebar-container docSidebarContainer_Cazd"><div class="sidebarViewport_XsVM"><div class="sidebar_Iuzv"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_tEnT"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/purpose">Purpose</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/workflow">Workflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/installation">Installation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/primitives">Primitives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/cli">Command-line interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contracts">Smart Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/circuits">Circuits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/trusted-setup">Trusted Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/testing">Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/testing-in-detail">Testing in detail</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/integrating">Integrating</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/audit">Security audits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/ci-pipeline">CI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/coordinator-processing">Coordinator local processing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/spec">Specification</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/key-change">Key change</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/troubleshooting">Troubleshooting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/versioning">MACI versioning</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/contributing/">Contributing</a><button aria-label="Expand sidebar category &#x27;Contributing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/topup">Topup</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/solidity-docs/">Solidity Docs</a><button aria-label="Expand sidebar category &#x27;Solidity Docs&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/typedoc/">Typedoc</a><button aria-label="Expand sidebar category &#x27;Typedoc&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_Aw6Y"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_mQIU"><div class="docItemContainer_IWC5"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_S2jZ" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_E5cy"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Integrating</span><meta itemprop="position" content="1"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: v1.x</span><div class="tocCollapsible_IFRJ theme-doc-toc-mobile tocMobile_l9eB"><button type="button" class="clean-btn tocCollapsibleButton_swoQ">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Integrating MACI</h1>
<p>MACI can be used in any protocol that requires collusion resistance, for instance it has been proven to be quite efficient when integrated in quadratic funding applications such as <a href="https://github.com/clrfund/monorepo" target="_blank" rel="noopener noreferrer">clr.fund</a> and <a href="https://github.com/quadratic-funding/qfi/tree/feat/code-freeze" target="_blank" rel="noopener noreferrer">qfi</a>.</p>
<p>Here we will be looking at QFI and how it was used. Please note that this will be expanded as QFI is updated to use the newest version of MACI. Should you decide to integrate MACI in the meantime, feel free to open an issue on the GitHub repo.</p>
<h2 class="anchor anchorWithStickyNavbar_I2WF" id="deployment">Deployment<a href="#deployment" class="hash-link" aria-label="Direct link to Deployment" title="Direct link to Deployment">​</a></h2>
<p>First, you need to deploy contracts to start using MACI. This can be easily done via <code>maci-cli</code>.
Deployment order is:</p>
<ol>
<li>Deploy crypto (Hasher, Poseidon)</li>
<li>Deploy VK Registry</li>
<li>Set verification keys</li>
<li>Deploy VoiceCreditProxy</li>
<li>Deploy Gatekeeper</li>
<li>Deploy Verifier</li>
<li>Deploy Topup credit</li>
<li>Deploy MessageProcessorFactory, PollFactory, SubsidyFactory, TallyFactory</li>
<li>Deploy MACI, AccQueueQuinaryMaci</li>
<li>Deploy Poll, AccQueueQuinaryMaci, MessageProcessor, Tally and Susbsidy (optional)</li>
</ol>
<p>Before running the deploy command make sure you have <a href="https://maci.pse.dev/docs/trusted-setup" target="_blank" rel="noopener noreferrer">zkey files</a> from trusted setup and env variables <code>ETH_PROVIDER</code> (RPC endpoint) and <code>ETH_SK</code> (wallet private key) are set. For production environment make sure you don&#x27;t use zkey files from our examples.</p>
<div class="language-bash codeBlockContainer_fGGS theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_GhYr"><pre tabindex="0" class="prism-code language-bash codeBlock_iyix thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Zmwf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli deployVkRegistry</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli setVerifyingKeys \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --state-tree-depth 10 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --int-state-tree-depth 1 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --msg-tree-depth 2 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --vote-option-tree-depth 2 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --msg-batch-depth 1 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --process-messages-zkey ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --tally-votes-zkey ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli create --stateTreeDepth 10</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli deployPoll \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --pubkey coordinator-public-key \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --duration 30 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --max-messages 25 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --max-vote-options 25 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --int-state-tree-depth 1 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --msg-tree-depth 2 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --msg-batch-depth 1 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --vote-option-tree-depth 2 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --subsidy-enabled false</span><br></span></code></pre><div class="buttonGroup_uUDv"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_X4PI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_C5XV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_TwkE"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_I2WF" id="signups-and-votes">Signups and votes<a href="#signups-and-votes" class="hash-link" aria-label="Direct link to Signups and votes" title="Direct link to Signups and votes">​</a></h2>
<p>Next, you can start accept user signup and votes. This can be done via <code>maci-cli</code> as well:</p>
<div class="language-bash codeBlockContainer_fGGS theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_GhYr"><pre tabindex="0" class="prism-code language-bash codeBlock_iyix thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Zmwf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli signup \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --pubkey user-public-key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli publish \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --pubkey user-public-key \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --privkey user-private-key \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --state-index 1 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --vote-option-index 0 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --new-vote-weight 9 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --nonce 1 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --poll-id 0</span><br></span></code></pre><div class="buttonGroup_uUDv"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_X4PI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_C5XV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_TwkE"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_I2WF" id="poll-finalization">Poll finalization<a href="#poll-finalization" class="hash-link" aria-label="Direct link to Poll finalization" title="Direct link to Poll finalization">​</a></h2>
<p>As a coordinator, first you need to merge signups and messages (votes). Signups and messages are stored in a queue so when the poll in over, the coordinator needs to create the tree from the queue. This optimization is needed to reduce gas cost for voters. Then coordinator generates proofs for the message processing, tally and subsidy calculations. This allows to publish the poll results on-chain and then everyone can verify the results when the poll is over.</p>
<div class="language-bash codeBlockContainer_fGGS theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_GhYr"><pre tabindex="0" class="prism-code language-bash codeBlock_iyix thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Zmwf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli mergeSignups --poll-id 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli mergeMessages --poll-id 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli genProofs \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --privkey coordinator-private-key \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --poll-id 0 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --process-zkey ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test.0.zkey \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --tally-zkey ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test.0.zkey \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --tally-file tally.json \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --output proofs/ \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --tally-wasm ./zkeys/TallyVotes_10-1-2_test/TallyVotes_10-1-2_test_js/TallyVotes_10-1-2_test.wasm \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --process-wasm ./zkeys/ProcessMessages_10-2-1-2_test/ProcessMessages_10-2-1-2_test_js/ProcessMessages_10-2-1-2_test.wasm \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --wasm</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli proveOnChain \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --poll-id 0 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --proof-dir proofs/ \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --subsidy-enabled false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">maci-cli verify \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --poll-id 0 \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --subsidy-enabled false \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    --tally-file tally.json # this file is generated in genProofs</span><br></span></code></pre><div class="buttonGroup_uUDv"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_X4PI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_C5XV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_TwkE"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>When poll finishes, <a href="https://github.com/privacy-scaling-explorations/maci/blob/dev/contracts/contracts/Tally.sol" target="_blank" rel="noopener noreferrer">Tally contract</a> emits the event with poll address so you can track the state changes.</p>
<div class="language-javascript codeBlockContainer_fGGS theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_GhYr"><pre tabindex="0" class="prism-code language-javascript codeBlock_iyix thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Zmwf"><span class="token-line" style="color:#bfc7d5"><span class="token plain">event </span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">BallotsTallied</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">address poll</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_uUDv"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_X4PI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_C5XV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_TwkE"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_I2WF" id="maci-contract">MACI Contract<a href="#maci-contract" class="hash-link" aria-label="Direct link to MACI Contract" title="Direct link to MACI Contract">​</a></h2>
<p>The MACI contract is the core of the protocol. Contracts can inherit from MACI and thus expose the signup and topup functions. As with standalone MACI, one would need to deploy a <a href="/docs/contracts#signupgatekeeper">sign up gatekeeper</a> as well as the <a href="/docs/contracts#voicecreditproxy">voice credit proxy</a>.</p>
<p>As an example, within the quadratic funding infrastructure project, the QFI contract inherits from MACI and allows sign up via the contribute function.</p>
<div class="language-javascript codeBlockContainer_fGGS theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_GhYr"><pre tabindex="0" class="prism-code language-javascript codeBlock_iyix thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Zmwf"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">contribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token parameter maybe-class-name">PubKey</span><span class="token parameter"> calldata pubKey</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token parameter">    uint256 amount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> external </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">snip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256 voiceCredits </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> amount </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> voiceCreditFactor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The user is marked as registered here upon contribution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    grantRoundToContributors</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">nextGrantRoundId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">ContributorStatus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">voiceCredits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Increase the number of contributors for this round</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    grantRoundToContributorsCount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">nextGrantRoundId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes memory signUpGatekeeperAndInitialVoiceCreditProxyData </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> abi</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">encode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        voiceCredits</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">signUp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        pubKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        signUpGatekeeperAndInitialVoiceCreditProxyData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        signUpGatekeeperAndInitialVoiceCreditProxyData</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">snip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    emit </span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">ContributionSent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> amount</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_uUDv"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_X4PI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_C5XV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_TwkE"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_I2WF" id="initialvoicecreditproxy">InitialVoiceCreditProxy<a href="#initialvoicecreditproxy" class="hash-link" aria-label="Direct link to InitialVoiceCreditProxy" title="Direct link to InitialVoiceCreditProxy">​</a></h2>
<p>If you&#x27;d like to extend the functionality of how votes are distributed among users, you need to extend <a href="https://github.com/privacy-scaling-explorations/maci/blob/dev/contracts/contracts/initialVoiceCreditProxy/InitialVoiceCreditProxy.sol" target="_blank" rel="noopener noreferrer">InitialVoiceCreditProxy</a> contract. You can see our <a href="https://github.com/privacy-scaling-explorations/maci/blob/dev/contracts/contracts/initialVoiceCreditProxy/ConstantInitialVoiceCreditProxy.sol" target="_blank" rel="noopener noreferrer">basic example</a> how it&#x27;s implemented for constant distribution.</p>
<div class="language-javascript codeBlockContainer_fGGS theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_GhYr"><pre tabindex="0" class="prism-code language-javascript codeBlock_iyix thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Zmwf"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// SPDX-License-Identifier: MIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pragma solidity </span><span class="token operator" style="color:rgb(137, 221, 255)">^</span><span class="token number" style="color:rgb(247, 140, 108)">0.8</span><span class="token number" style="color:rgb(247, 140, 108)">.10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword module" style="font-style:italic">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">InitialVoiceCreditProxy</span><span class="token imports"> </span><span class="token imports punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"> </span><span class="token keyword module" style="font-style:italic">from</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;./InitialVoiceCreditProxy.sol&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/// @title ConstantInitialVoiceCreditProxy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/// @notice This contract allows to set a constant initial voice credit balance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/// for MACI&#x27;s voters.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">contract </span><span class="token maybe-class-name">ConstantInitialVoiceCreditProxy</span><span class="token plain"> is </span><span class="token maybe-class-name">InitialVoiceCreditProxy</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/// @notice the balance to be returned by getVoiceCredits</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  uint256 internal balance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/// @notice creates a new ConstantInitialVoiceCreditProxy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/// @param _balance the balance to be returned by getVoiceCredits</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">constructor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">uint256 _balance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> payable </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    balance </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> _balance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/// @notice Returns the constant balance for any new MACI&#x27;s voter</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/// @return balance</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">getVoiceCredits</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">address</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> bytes memory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">public</span><span class="token plain"> view override </span><span class="token function" style="color:rgb(130, 170, 255)">returns</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">uint256</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> balance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_uUDv"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_X4PI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_C5XV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_TwkE"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_I2WF" id="subsidy">Subsidy<a href="#subsidy" class="hash-link" aria-label="Direct link to Subsidy" title="Direct link to Subsidy">​</a></h2>
<p>It&#x27;s also possible to use subsidy feature when coordinator deploys polls, proves poll results on-chain and when poll results are verified. This contract is used to verify that the subsidy calculations are correct. It is also used to update the subsidy commitment if the proof is valid. To enable this feature just provide <code>--subsidy-enabled</code> or <code>-se</code> for <code>maci-cli</code> commands (<code>deployPoll</code>, <code>proveOnChain</code>, <code>verify</code>).</p>
<h2 class="anchor anchorWithStickyNavbar_I2WF" id="poll-contract">Poll Contract<a href="#poll-contract" class="hash-link" aria-label="Direct link to Poll Contract" title="Direct link to Poll Contract">​</a></h2>
<p>On the other hand, the Poll contract can be inherited to expose functionality such as top ups and publishing of messages/commands.</p>
<p>For instance, within QFI, the <code>publishMessageBatch</code> function call the <code>publishMessage</code> function of Poll, as shown below:</p>
<div class="language-javascript codeBlockContainer_fGGS theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_GhYr"><pre tabindex="0" class="prism-code language-javascript codeBlock_iyix thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_Zmwf"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">publishMessageBatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token parameter maybe-class-name">Message</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token parameter"> calldata _messages</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token parameter">    </span><span class="token parameter maybe-class-name">PubKey</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token parameter"> calldata _encPubKeys</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> external </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Check that the two arrays have the same length</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">require</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        _messages</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">==</span><span class="token plain"> _encPubKeys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;GrantRound: _messages and _encPubKeys should be the same length&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256 batchSize </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> _messages</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">uint8 i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> batchSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">publishMessage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_messages</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _encPubKeys</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    emit </span><span class="token function maybe-class-name" style="color:rgb(130, 170, 255)">Voted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">sender</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_uUDv"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_X4PI" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_C5XV"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_TwkE"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/privacy-scaling-explorations/maci/edit/dev/website/versioned_docs/version-v1.x/integrating.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_A4i3" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_uNWa"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/testing-in-detail"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Testing in detail</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/audit"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Security audits</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_DN96 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#deployment" class="table-of-contents__link toc-highlight">Deployment</a></li><li><a href="#signups-and-votes" class="table-of-contents__link toc-highlight">Signups and votes</a></li><li><a href="#poll-finalization" class="table-of-contents__link toc-highlight">Poll finalization</a></li><li><a href="#maci-contract" class="table-of-contents__link toc-highlight">MACI Contract</a></li><li><a href="#initialvoicecreditproxy" class="table-of-contents__link toc-highlight">InitialVoiceCreditProxy</a></li><li><a href="#subsidy" class="table-of-contents__link toc-highlight">Subsidy</a></li><li><a href="#poll-contract" class="table-of-contents__link toc-highlight">Poll Contract</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Documentation</a></li><li class="footer__item"><a href="https://github.com/privacy-scaling-explorations/maci" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_zI7a"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/invite/sF5CT5rzrR" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_zI7a"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/zkMACI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_zI7a"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Privacy and Scaling Explorations</div></div></div></footer></div>
</body>
</html>